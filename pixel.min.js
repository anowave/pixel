window.anowavePixel=(()=>{const a=(a,b)=>{!window.google_tag_manager?function(c,e,d,g,h){c[g]=c[g]||[],c[g].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var i=e.getElementsByTagName(d)[0],f=e.createElement(d),j="dataLayer"==g?"":"&l="+g;f.async=!0,f.onload=()=>{console.log("Anowave",a.container_id,"loaded"),window.dataLayer=window.dataLayer||[],b()},f.src="https://www.googletagmanager.com/gtm.js?id="+h+j,i.parentNode.insertBefore(f,i)}(window,document,"script","dataLayer",a.container_id):b()};return{attach:function(b,c,d,e){const f={trackBeginCheckout:a=>{const b=a?.data?.checkout;let c=[],d=0;b?.lineItems.forEach(a=>{c.push({item_id:a?.variant?.product?.id,item_name:a?.variant?.product?.title,item_variant:a?.variant?.title,item_list_name:"Checkout",price:a?.finalLinePrice?.amount,currency:a?.finalLinePrice?.currencyCode,quantity:a?.quantity}),d+=a?.finalLinePrice?.amount});const e={event:"begin_checkout",ecommerce:{currency:a?.data?.checkout?.currencyCode,items:c,value:d}};return e},trackAddShippingInfo:a=>{const b=a.data.checkout;let c=[],d=0;b?.lineItems.forEach(a=>{c.push({item_id:a?.variant?.product?.id,item_name:a?.variant?.product?.title,item_variant:a?.variant?.title,item_category:"",price:a?.finalLinePrice?.amount,currency:a?.finalLinePrice?.currencyCode,quantity:a?.quantity}),d+=a?.finalLinePrice?.amount});const e={event:"add_shipping_info",ecommerce:{currency:b?.currencyCode,items:c,shipping_tier:b?.delivery?.selectedDeliveryOptions?.[0].title,value:d}};return e},trackAddPaymentInfo:a=>{const b=a.data.checkout;let c=[],d=0;b?.lineItems.forEach(a=>{c.push({item_id:a?.variant?.product?.id,item_name:a?.variant?.product?.title,item_variant:a?.variant?.title,item_category:"",price:a?.finalLinePrice?.amount,currency:a?.finalLinePrice?.currencyCode,quantity:a?.quantity}),d+=a?.finalLinePrice?.amount});const e=b.discountApplications[0]?.type,f=["DISCOUNT_CODE","AUTOMATIC"].includes(e)?b.discountApplications[0]?.title:null,g={event:"add_payment_info",ecommerce:{currency:b?.currencyCode,items:c,payment_type:"",value:d,coupon:f}};return g},trackPurchase:a=>{const b=a?.data?.checkout;let c=[];b.transactions.map(a=>({paymentGateway:a.gateway,amount:a.amount}));b?.lineItems.forEach(a=>{c.push({item_id:a?.variant?.product?.id,item_name:a?.variant?.product?.title,item_variant:a?.variant?.title,item_category:"",price:a?.finalLinePrice?.amount,currency:a?.finalLinePrice?.currencyCode,quantity:a?.quantity})});const d=b.discountApplications.map(a=>{if("DISCOUNT_CODE"===a.type)return a.title}),e={event:"purchase",ecommerce:{currency:b?.currencyCode,items:c,transaction_id:b?.order?.id,coupon:"",shipping:b?.shippingLine?.price?.amount,tax:b?.totalTax?.amount,customer_type:b?.order?.customer?.isFirstOrder?"new":"returning",value:b?.totalPrice?.amount}};return e}};return Object.entries({checkout_started:a=>f.trackBeginCheckout(a),checkout_shipping_info_submitted:a=>f.trackAddShippingInfo(a),payment_info_submitted:a=>f.trackAddPaymentInfo(a),checkout_completed:a=>f.trackPurchase(a)}).forEach(([c,d])=>{b.subscribe(c,function(b){(b=>{a(e,()=>{let a=d(b);dataLayer.push({ecommerce:null}),dataLayer.push(a),console.log("Anowave","Custom Pixel Push",e.version,dataLayer)})})(b)})}),b.subscribe("checkout_completed",function(a){let b=[];const c=a?.data?.checkout;c?.lineItems.forEach(a=>{b.push({item_id:a?.variant?.product?.id,item_name:a?.variant?.product?.title,item_variant:a?.variant?.title,price:a?.finalLinePrice?.amount,currency:a?.finalLinePrice?.currencyCode,quantity:a?.quantity})});const d={send_to:e.send_to,value:c.totalPrice?.amount,currency:c.currencyCode,transaction_id:c.order?.id,items:b,aw_merchant_id:e.aw_merchant_id,aw_feed_country:e.aw_feed_country,aw_feed_language:e.aw_feed_language,aw_feed_label:e.aw_feed_label,new_customer:!0};(function(a,b,c,e,g){var h=b.createElement(c);h.async=!0,h.src=e+"?id="+g;var i=b.getElementsByTagName(c)[0];i.parentNode.insertBefore(h,i),h.onload=function(){function b(){a.dataLayer.push(arguments)}a.dataLayer=a.dataLayer||[],b("js",new Date),b("config",g),b("event","conversion",d),console.debug("Anowave","Google Ads Conversion:",d)}})(window,document,"script","https://www.googletagmanager.com/gtag/js",e.measurement_id)}),this}}})();